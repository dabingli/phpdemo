一、mysql安装

1、安装依赖插件
yum -y install ncurses ncurses-devel bison cmake

2、创建数据库用户
添加禁止登陆的mysql用户
groupadd mysql
useradd -r -g mysql -s /bin/false mysql

3、解压，安装boost
tar -xf boost_1_59_0.tar.gz 【mysql5.7须安装boost】
cd boost_1_59_0
./bootstrap.sh
./b2 install 

注:此处如果只为安装mysql其实可以不用安装的，解压就好，到时安装mysql时引用目录，不过percona-xtrabackup需要用到


4、安装mysql
cmake \  参数说明

-DCMAKE_INSTALL_PREFIX=/usr/local/mysql \ //定义安装目录
-DMYSQL_UNIX_ADDR=/usr/local/mysql/mysql.sock \ //连接数据库socket路径
-DSYSCONFDIR=/etc \ //指定初始化参数文件目录（my.cnf）
-DSYSTEMD_PID_DIR=/usr/local/mysql \ //数据库目录
-DDEFAULT_CHARSET=utf8 \ //指定默认使用的字符集编码
-DDEFAULT_COLLATION=utf8_general_ci \ //指定默认使用的字符集校对规则，utf8_general_ci是适用于UTF-8字符集的通用规则
-DWITH_INNOBASE_STORAGE_ENGINE=1 \ //支持InnoDB引擎
-DWITH_ARCHIVE_STORAGE_ENGINE=1 \ 
-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \
-DWITH_PERFSCHEMA_STORAGE_ENGINE=1 \ //安装支持数据库分区
-DMYSQL_DATADIR=/usr/local/mysql/data \
-DWITH_BOOST=boost \
-DWITH_SYSTEMD=1
（注意：如果在CMAKE的过程中有报错，当报错解决后，需要把源码目录中的
CMakeCache.txt文件删除，然后再重新CMAKE，否则错误依旧,cmake版本低也可能报错）


tar -xf mysql-5.7.17.tar.gz
cd mysql-5.7.17
cmake -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DMYSQL_DATADIR=/home/mysql/data -DDOWNLOAD_BOOST=1 -DWITH_BOOST=/usr/local/boost_1_59_0 -DSYSCONFDIR=/etc -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_PARTITION_STORAGE_ENGINE=1 -DWITH_FEDERATED_STORAGE_ENGINE=1 -DWITH_BLACKHOLE_STORAGE_ENGINE=1 -DWITH_MYISAM_STORAGE_ENGINE=1 -DENABLED_LOCAL_INFILE=1 -DENABLE_DTRACE=0 -DDEFAULT_CHARSET=utf8mb4 -DDEFAULT_COLLATION=utf8mb4_general_ci -DWITH_EMBEDDED_SERVER=1

make && make install

5、配置启动项
cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld
chown -R mysql.mysql /usr/local/mysql/
chmod +x /etc/init.d/mysqld
chkconfig --add mysqld
chkconfig mysqld on

6、初始化数据
/usr/local/mysql/bin/mysqld --initialize-insecure --user=mysql --basedir=/usr/local/mysql --datadir=/home/mysql/data

注： 之前版本mysql_install_db是在mysql_basedir/script下，5.7放在了mysql_install_db/bin目录下,且已被废弃
“Cinitialize”会生成一个随机密码(~/.mysql_secret)，而”Cinitialize-insecure”不会生成密码
Cdatadir目标目录下不能有数据文件


//手动创建日志文件
touch /home/mysql/logs/mysqld.log

7、启动数据库
service mysqld start


注意：如启动不了须检查/etc/my.cnf文件配置，以及.log/.pid等文件权限
【ps -ef | grep mysql  & kill -9 pid】

CREATE DATABASE xey; //创建数据库myadm
CREATE USER 'xey'@'localhost' IDENTIFIED BY 'xey123..yex';
GRANT all ON xey.* TO 'xey'@'localhost' IDENTIFIED BY 'xey123..yex';
GRANT all ON xey.* TO 'xey'@'%' IDENTIFIED BY 'xey123..yex'; //授权
flush privileges; //刷新权限


CREATE USER 'cyj'@'localhost' IDENTIFIED BY 'cyj55.89TuT';
GRANT all ON cyj.* TO cyj@'localhost' IDENTIFIED BY 'cyj55.89TuT';
GRANT all ON cyj.* TO cyj@'%' IDENTIFIED BY 'cyj55.89TuT' WITH GRANT OPTION;
flush privileges;
